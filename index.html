<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>BSCBIT Y2 S2 Timetable</title>
  <H2>Make sure to open site daily to get notifications before class</H2>

  <!-- React -->
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- PDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
</head>

<body class="bg-gray-100 dark:bg-gray-900 min-h-screen transition">
  <div id="root"></div>

<script type="text/babel">
const COLORS = {
  BIDB2210: "border-blue-500 bg-blue-50 dark:bg-blue-900/20",
  BIBS2210: "border-green-500 bg-green-50 dark:bg-green-900/20",
  BIBI2210: "border-purple-500 bg-purple-50 dark:bg-purple-900/20",
  BICC2210: "border-orange-500 bg-orange-50 dark:bg-orange-900/20",
  BIOP2210: "border-pink-500 bg-pink-50 dark:bg-pink-900/20",
  BISA2210: "border-yellow-500 bg-yellow-50 dark:bg-yellow-900/20",
};

const timetable = {
  Monday: [
    { time:"12:30 - 14:30", code:"BIDB2210", course:"Database System", venue:"MM7 | New One", group:"A" },
    { time:"14:30 - 16:30", code:"BIDB2210", course:"Database System", venue:"MM7 | New One", group:"B" }
  ],
  Tuesday: [
    { time:"08:30 - 10:30", code:"BIBS2210", course:"Business Statistics", venue:"Room 1 | Nthatisi Monakalali", group:"ALL" },
    { time:"14:30 - 16:30", code:"BIBI2210", course:"Business Information Systems", venue:"Hall 6 | Uduak Inno Ebioh", group:"ALL" }
  ],
  Wednesday: [],
  Thursday: [
    { time:"08:30 - 10:30", code:"BICC2210", course:"Cloud Computing", venue:"MM7 | Mantsebo Molapo", group:"A" },
    { time:"10:30 - 12:30", code:"BICC2210", course:"Cloud Computing", venue:"MM7 | Mantsebo Molapo", group:"B" },
    { time:"12:30 - 14:30", code:"BIOP2210", course:"OOP II", venue:"MM2 | Liteboho Moloaoa", group:"A" },
    { time:"14:30 - 16:30", code:"BIOP2210", course:"OOP II", venue:"MM2 | Liteboho Moloaoa", group:"B" }
  ],
  Friday: [
    { time:"08:30 - 10:30", code:"BIOP2210", course:"OOP II", venue:"MM4 | Tsepo Mofolo", group:"ALL" },
    { time:"10:30 - 12:30", code:"BIOP2210", course:"OOP II", venue:"MM4 | Tsepo Mofolo", group:"ALL" },
    { time:"12:30 - 14:30", code:"BISA2210", course:"Systems Analysis & Design", venue:"Hall 6 | New Two", group:"ALL" }
  ]
};

const days = ["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];

function App() {
  const [group,setGroup] = React.useState("A");
  const [dark,setDark] = React.useState(localStorage.getItem("dark")==="1");

  React.useEffect(()=>{
    document.documentElement.classList.toggle("dark",dark);
    localStorage.setItem("dark",dark?"1":"0");
  },[dark]);

  const today = days[new Date().getDay()];

  const toMinutes = t => {
    const [h,m] = t.split(":").map(Number);
    return h*60+m;
  };

  const scheduleReminders = () => {
    if (!("Notification" in window)) return;

    Notification.requestPermission().then(permission => {
      if (permission !== "granted") return;

      const now = new Date();
      const currentMinutes = now.getHours()*60 + now.getMinutes();

      (timetable[today] || [])
        .filter(s => s.group==="ALL" || s.group===group)
        .forEach(s => {
          const start = toMinutes(s.time.split(" - ")[0]);
          const reminderAt = start - 15;
          const delay = (reminderAt - currentMinutes) * 60000;

          const key = `${today}-${s.course}-${start}`;
          if (delay > 0 && !localStorage.getItem(key)) {
            setTimeout(() => {
              new Notification("ðŸ“š Lecture Reminder", {
                body: `${s.course} at ${s.venue}\nStarts at ${s.time.split(" - ")[0]}`,
              });
              localStorage.setItem(key,"1");
            }, delay);
          }
        });
    });
  };

  React.useEffect(scheduleReminders,[group]);

  const exportPDF = () => {
    html2pdf().from(document.getElementById("timetable")).save("BSCBIT_Y2_S2_Timetable.pdf");
  };

  return (
    <div className="p-6 max-w-6xl mx-auto text-gray-900 dark:text-gray-100">
      <h1 className="text-3xl font-bold text-center mb-4">BSCBIT Y2 S2 Timetable</h1>

      <div className="flex flex-wrap justify-center gap-3 mb-6">
        <button onClick={()=>setGroup("A")} className="px-4 py-2 border rounded">Group A</button>
        <button onClick={()=>setGroup("B")} className="px-4 py-2 border rounded">Group B</button>
        <button onClick={()=>setDark(!dark)} className="px-4 py-2 border rounded">ðŸŒ™ Dark</button>
        <button onClick={exportPDF} className="px-4 py-2 border rounded">ðŸ“„ PDF</button>
      </div>

      <div id="timetable" className="grid md:grid-cols-2 lg:grid-cols-3 gap-4">
        {Object.entries(timetable).map(([day,sessions])=>{
          const list = sessions.filter(s=>s.group==="ALL"||s.group===group);
          if(!list.length) return null;

          return (
            <div key={day} className={`rounded-xl shadow p-4 ${day===today?"ring-2 ring-blue-500":""}`}>
              <h2 className="font-semibold text-lg mb-3">{day}</h2>
              {list.map((s,i)=>(
                <div key={i} className={`border-l-4 p-3 mb-3 rounded ${COLORS[s.code]}`}>
                  <p className="text-sm">{s.time}</p>
                  <p className="font-semibold">{s.course}</p>
                  <p className="text-xs">{s.venue}</p>
                </div>
              ))}
            </div>
          );
        })}
      </div>
    </div>
  );
}

ReactDOM.createRoot(document.getElementById("root")).render(<App />);
</script>
</body>
</html>
